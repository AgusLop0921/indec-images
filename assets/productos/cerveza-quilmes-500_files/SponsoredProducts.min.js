(window.webpackJsonpdiscoargentina_cmedia_integration_cencosud_1_0_0=window.webpackJsonpdiscoargentina_cmedia_integration_cencosud_1_0_0||[]).push([["SponsoredProducts"],[,function(e,t){e.exports=React},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a}));var r=function(){return(new Date).toISOString()},o=function(){return"event".concat((new Date).getTime())},a=function(e){if(e.includes("/")){var t=e.split("/");return t[t.length-1]}return e}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return d})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return p})),n.d(t,"f",(function(){return v}));var r=n(0),o=n.n(r),a=n(2),i=n(4),c="/_v/cmedia/promotional/product",u={"content-type":"application/json"},s=function(){var e=Object(a.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/category/",n=Object(i.b)(t),e.next=4,fetch("".concat(c).concat("/category/").concat(n),{method:"GET",headers:u});case 4:if((r=e.sent).ok){e.next=7;break}throw new Error("Network response was not ok.");case 7:return e.abrupt("return",r.json());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(a.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/collection/",n=Object(i.b)(t),e.next=4,fetch("".concat(c).concat("/collection/").concat(n),{method:"GET",headers:u});case 4:if((r=e.sent).ok){e.next=7;break}throw new Error("Network response was not ok.");case 7:return e.abrupt("return",r.json());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(a.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(c,"?search=").concat(t,"&skus=").concat(n),{method:"GET",headers:u});case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("Network response was not ok.");case 5:return e.abrupt("return",r.json());case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=Object(a.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/_v/cmedia/event/click",{method:"POST",body:JSON.stringify({productData:t})});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Network response was not ok.");case 6:return e.abrupt("return",n.json());case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(a.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/_v/cmedia/event/impression",{method:"POST",body:JSON.stringify({productData:t})});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Network response was not ok.");case 6:return e.abrupt("return",n.json());case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(a.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/_v/cmedia/event/purchase",{method:"POST",body:JSON.stringify({productData:t})});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Network response was not ok.");case 6:return e.abrupt("return",n.json());case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},,function(e,t){e.exports=__RENDER_8_RUNTIME__},function(e,t){e.exports=ReactApollo},,,function(e,t){e.exports=__RENDER_8_COMPONENTS__["vtex.order-manager@0.x/OrderForm"]},function(e,t){e.exports=__RENDER_8_COMPONENTS__["vtex.search-page-context@0.x/SearchPageContext"]},function(e,t){e.exports=__RENDER_8_COMPONENTS__["vtex.session-client@1.x/useRenderSession"]},,,function(e,t){e.exports=regeneratorRuntime},,,,,function(e,t){e.exports=__RENDER_8_COMPONENTS__["vtex.search-result@3.x/Gallery"]},,,,,function(e,t,n){e.exports={skeleton:"discoargentina-cmedia-integration-cencosud-1-x-skeleton",shimmer:"discoargentina-cmedia-integration-cencosud-1-x-shimmer"}},,,,,function(e,t,n){"use strict";n.r(t),function(e){var t=n(7);n.p=Object(t.getPublicPath)("discoargentina.cmedia-integration-cencosud@1.0.0");var r=Object(t.register)((function(){return n(35)}),e,"discoargentina.cmedia-integration-cencosud@1.0.0","discoargentina.cmedia-integration-cencosud@1.x","SponsoredProducts");r.renderHotReload,r.setupHMR}.call(this,n(16)(e))},,,function(e,t,n){"use strict";n.r(t);var r=n(21),o=n(3),a=n(1),i=n.n(a),c=n(22),u=n.n(c),s=n(0),d=n.n(s),l=n(2),f=n(10),p=n(13),v=n(14),m=n.n(v),h=n(9),b=n(12),g=n(8),y=n(6),x=n(4);function w(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var j={"content-type":"application/json"},k=function(){var e=Object(l.a)(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/api/checkout/pub/orderForm/"+t,"/customData/sponsored-products-cart/ProductsId"),{method:"PUT",headers:j,body:JSON.stringify({value:n})});case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("Network response was not ok.");case 5:return e.abrupt("return",r.json());case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),S=n(19),_=n.n(S),E=n(11);function I(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N,q=!0,A=function(e){var t=e.products,n=Object(p.useSearchPage)(),r=n.searchQuery,i=n.map,c=n.maxItemsPerPage,u=m()().session,s={sendEventImpresion:function(e){var t,n=[],r=w(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(!o.product)return;var a={id:Object(x.c)(),occurredAt:Object(x.a)(),opaqueUserId:o.product.sponsoredData.opaqueUserId,placement:{path:o.product.sponsoredData.path,position:o.position,page:o.product.sponsoredData.page,pageSize:o.product.sponsoredData.pageSize,categoryId:o.product.sponsoredData.categoryId},resolvedBidId:o.product.sponsoredData.resolvedBidId};n.push(a)}}catch(e){r.e(e)}finally{r.f()}Object(y.e)(n)}},v=Object(b.useOrderForm)().orderForm,O=v.items,j=v.id,S=Object(a.useState)(!0),T=Object(o.a)(S,2),N=T[0],A=T[1],C=Object(a.useState)(),P=Object(o.a)(C,2),D=P[0],R=P[1],F=Object(a.useState)({query:"",isFullTextSearch:!1}),M=Object(o.a)(F,2),U=M[0],B=M[1],J=Object(h.useApolloClient)();Object(a.useEffect)((function(){D&&O&&function(){if(O&&0!==O.length&&D&&D.winners&&0!==D.winners.length){var e=[];D.winners.forEach((function(t){O.forEach((function(n){t.sku===n.productId&&e.push("".concat(t.sku,"-").concat(n.id))}))}));var t=Object(f.a)(new Set(e));if(0!==t.length){var n=t.join(",");n&&k(j,n)}}}()}),[D,O]);var L=function(){var e=Object(l.a)(d.a.mark((function e(t){var n,r,o,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.winners.map((function(e){return e.sku})),e.prev=1,e.next=4,J.query({query:_.a,variables:{values:o}});case 4:return a=e.sent,e.abrupt("return",null!==(r=null===(n=null==a?void 0:a.data)||void 0===n?void 0:n.productsByIdentifier)&&void 0!==r?r:[]);case 8:e.prev=8,e.t0=e.catch(1),console.error("Error fetching products data",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),G=function(e,t){var n,r=e.split("/"),o=r[r.length-1],a=I(t);try{for(a.s();!(n=a.n()).done;){var i,c=I(n.value.facets);try{for(c.s();!(i=c.n()).done;){var u=i.value;if(u.value===o)return u.id}}catch(e){c.e(e)}finally{c.f()}}}catch(e){a.e(e)}finally{a.f()}return null},H=function(){var e=Object(l.a)(d.a.mark((function e(){var n,o,a,c,u,s,l,f,p,v,m,h,b,g,x,w,O,j;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m=null===(o=null===(n=null==r?void 0:r.facets)||void 0===n?void 0:n.queryArgs)||void 0===o?void 0:o.query,h="productClusterIds"===(null===(c=null===(a=null==r?void 0:r.facets)||void 0===a?void 0:a.queryArgs)||void 0===c?void 0:c.map)?"col-".concat(null===(s=null===(u=null==r?void 0:r.facets)||void 0===u?void 0:u.queryArgs)||void 0===s?void 0:s.query):G(m,null===(l=null==r?void 0:r.facets)||void 0===l?void 0:l.specificationFilters),b="ft"===i,g=i.split(",").includes("brand"),x=null===(v=null===(p=null===(f=null==r?void 0:r.facets)||void 0===f?void 0:f.queryArgs)||void 0===p?void 0:p.map)||void 0===v?void 0:v.split(",").includes("price"),m!==U.query||b!==U.isFullTextSearch){e.next=7;break}return e.abrupt("return");case 7:if(R(void 0),w=t.map((function(e){return e.productId})).toString(),!b){e.next=16;break}return e.next=12,Object(y.b)(m,w);case 12:O=e.sent,B({query:m,isFullTextSearch:b}),e.next=34;break;case 16:if(!g&&!x){e.next=23;break}return e.next=19,Object(y.b)(m,w);case 19:O=e.sent,B({query:m,isFullTextSearch:b}),e.next=34;break;case 23:if(!h.startsWith("col-")){e.next=29;break}return e.next=26,Object(y.c)(h);case 26:e.t0=e.sent,e.next=32;break;case 29:return e.next=31,Object(y.a)(h);case 31:e.t0=e.sent;case 32:O=e.t0,B({query:h,isFullTextSearch:b});case 34:if(0!==O.winners.length){e.next=37;break}return q=!1,e.abrupt("return");case 37:return q=!0,e.next=40,L(O);case 40:j=e.sent,R(Object.assign(Object.assign({},O),{products:j}));case 42:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){H();var e=function(){var e,t,n,r=document.querySelector(".vtex-search-result-3-x-filterPopupTitle");return(null===(e=null==r?void 0:r.textContent)||void 0===e?void 0:e.toLowerCase().includes("relevantes"))||(null===(t=null==r?void 0:r.textContent)||void 0===t?void 0:t.toLowerCase().includes("relevancia"))||(null===(n=null==r?void 0:r.textContent)||void 0===n?void 0:n.toLowerCase().includes("relevância"))||!1}();A(e)}),[t]);var W=function(e,t,n){var o,a,i,s;return Object.assign(Object.assign({},e),{clusterHighlights:[].concat(Object(f.a)(e.clusterHighlights),[{id:"0",name:"Patrocinado"}]),sponsoredData:{categoryId:Object(x.b)(null===(a=null===(o=null==r?void 0:r.facets)||void 0===o?void 0:o.queryArgs)||void 0===a?void 0:a.query),opaqueUserId:null==u?void 0:u.id,path:null===(s=null===(i=null==r?void 0:r.facets)||void 0===i?void 0:i.breadcrumb[0])||void 0===s?void 0:s.href,page:"".concat(n),pageSize:c,resolvedBidId:t.resolvedBidId}})};return{productsToShow:Object(a.useMemo)((function(){var e,n,r,o,a,i,u,d,l,f=g.canUseDOM?localStorage.getItem("country"):"COL",p=g.canUseDOM?localStorage.getItem("foreignBuy"):"COL",v=t.findIndex((function(e){return!("20103262"!==e.productId||f&&"COL"!==f&&"COL"!==p)}));if(-1!==v&&t.splice(v,1),!D||!(null===(e=D.products)||void 0===e?void 0:e.length)||!N)return t;for(var m=D.products.filter((function(e){return e.items.some((function(e){return e.sellers.some((function(e){return e.commertialOffer.AvailableQuantity>0}))}))})),h=m.map((function(e){return e.productId})),b=t.filter((function(e){return!h.includes(e.productId)})),y=function(e){var t=1;if("colombia"===e)return document.querySelectorAll(".tiendasjumboqaio-jumbo-fetch-more-paginator-0-x-container-dropdown .vtex-dropdown__caption>div").forEach((function(e){var n=e.innerText,r=parseFloat(n.replace(/[^0-9.]/g,""));t=r})),t;var n=new URLSearchParams(window.location.search);return t=n.get("page")||1}(E.b),x=c*y-c,w=c*y,O=[],j=0,k=[],S=0;S<D.winners.length;S++)D.positions[j]>x&&D.positions[j]<w&&function(){var e=D.winners[S],t=m.find((function(t){return t.productId===e.sku}));if(t){O.push({id:"argentina"===String(E.b)?null===(r=null===(n=null==t?void 0:t.items)||void 0===n?void 0:n[0])||void 0===r?void 0:r.itemId:null==t?void 0:t.productId,resolved_bid_id:null==e?void 0:e.resolvedBidId,sponsored:!0,item_negocio:null===(u=null===(i=null===(a=null===(o=null==t?void 0:t.items)||void 0===o?void 0:o[0])||void 0===a?void 0:a.referenceId)||void 0===i?void 0:i[0])||void 0===u?void 0:u.Value,item_master_vtex:null==t?void 0:t.productId,item_variante_vtex:null===(l=null===(d=null==t?void 0:t.items)||void 0===d?void 0:d[0])||void 0===l?void 0:l.itemId,item_patrocinado:null==e?void 0:e.sku});var c=W(t,e,y);b.splice(D.positions[j]-1-x,0,c),k.push({product:c,position:D.positions[j]}),j++}}();s.sendEventImpresion(k);var _=JSON.parse(localStorage.getItem("sponsoredProducts")||"[]");return O.forEach((function(e){_.some((function(t){return(null==t?void 0:t.id)===(null==e?void 0:e.id)}))||_.push(e)})),localStorage.setItem("sponsoredProducts",JSON.stringify(_)),b}),[N,t,D,c]),hasWinners:q}},C=n(27),P=n.n(C);!function(e){e.Circle="Circle",e.Square="Square"}(N||(N={}));var D=function(e){var t=e.type,n=void 0===t?N.Circle:t,r=e.height,o=void 0===r?40:r,a=e.width,c=void 0===a?40:a,u=e.colorBackGround;return i.a.createElement("div",{style:{height:o,width:c,position:"relative",background:u||"#f4f4f4",borderRadius:n===N.Circle?"50%":"4px"},className:"".concat(P.a.skeleton),"data-testid":"skeleton"})},R=function(){return i.a.createElement("div",{style:{borderRadius:"8px",padding:"16px",width:"100%",maxWidth:"250px",margin:"0 8px",display:"flex",flexDirection:"column",alignItems:"center"}},i.a.createElement(D,{type:"Square",width:230,height:150}),i.a.createElement("div",{style:{marginTop:"16px",width:"100%",textAlign:"center"}},i.a.createElement(D,{type:"Square",width:180,height:20}),i.a.createElement("div",{style:{marginTop:"8px"}},i.a.createElement(D,{type:"Square",width:130,height:20}))))},F=function(){return i.a.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px",justifyContent:"center",marginTop:"20px"}},Object(f.a)(Array(4)).map((function(e,t){return i.a.createElement(R,{key:t})})))},M=function(e){var t=A(e),n=t.productsToShow,c=t.hasWinners,s=Object(a.useState)(!1),d=Object(o.a)(s,2),l=d[0],f=d[1],p=Object(a.useState)([]),v=Object(o.a)(p,2),m=v[0],h=v[1];return Object(a.useEffect)((function(){h([]),f(!1);var e=setTimeout((function(){f(!0),h(n)}),2e3);return function(){return clearTimeout(e)}}),[e.products,n]),!l&&c?i.a.createElement(i.a.Fragment,null,Array.from(Array(4).keys()).map((function(e,t){return i.a.createElement(F,{key:t})}))):c?i.a.createElement(u.a,Object(r.a)({},e,{products:m})):i.a.createElement(u.a,e)};t.default=M}],[[32,"common",0]]]);